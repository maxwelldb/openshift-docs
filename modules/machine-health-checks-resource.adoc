// Module included in the following assemblies:
//
// * machine_management/deploying-machine-health-checks.adoc

[id="machine-health-checks-resource_{context}"]
= Sample MachineHealthCheck resource

The MachineHealthCheck resource resembles the following YAML file:

// Olde sample
// .MachineHealthCheck
// [source,yaml]
// ----
// apiVersion: healthchecking.openshift.io/v1alpha1
// kind: MachineHealthCheck
// metadata:
//  name: example <1>
//  namespace: openshift-machine-api
// Spec:
//   Selector:
//     matchLabels:
//       machine.openshift.io/cluster-api-cluster: <cluster_name> <2>
//       machine.openshift.io/cluster-api-machine-role: <label> <3>
//       machine.openshift.io/cluster-api-machine-type: <label> <3>
//       machine.openshift.io/cluster-api-machineset: <cluster_name>-<label>-<AWS-zone> <4>
// ----

.MachineHealthCheck
[source,yaml]
----
apiVersion: machine.openshift.io/v1beta1
kind: MachineHealthCheck
metadata:
  name: example <1>
  namespace: openshift-machine-api
spec:
  selector:
    matchLabels:
      role: worker <2>
  unhealthyConditions:
  - type:    "Ready"
    status:  "Unknown"
    timeout: "300s"
  - type:    "Ready"
    status:  "False"
    timeout: "300s"
  maxUnhealthy: "40%"
status:
  currentHealthy: 5
  expectedMachines: 5
----
<1> Specify the name of the MachineHealthCheck to deploy. Include the name of the
MachinePool to track.
<2> Specify a role for the MachinePool to track.
// <3> Specify a label for the MachinePool that you want to check.
// <4> Specify the MachineSet to track in `<cluster_name>-<label>-<AWS-zone>`
// format. For example, `prod-node-us-east-1a`.

////

.MachinePoolHealthCheck
[source,yaml]
----
apiVersion: healthchecking.machineapi.openshift.io/v1alpha1
kind: MachinePoolHealthCheck
metadata:
 name: worker-pool-healthcheck
 namespace: openshift-machine-api
 annotations:
Spec:
  MachineSelector:  metav1.LabelSelector
----

.MachineRemediation
[source,yaml]
----
apiVersion: healthchecking.machineapi.openshift.io/v1alpha1
kind: MachineRemediation
metadata:
 name: worker-pool-healthcheck-machineName
 namespace: openshift-machine-api
 annotations:
Spec:
  machineName: “machineName”
  remediationStrategy: “default”
Status:
  Phase:     “healthy”
  Reason:    “no unhealthy conditions detected”
  StartTime: “metav1.now()”
////